chrome.runtime.onMessage.addListener((o,f,I)=>{const{action:l,domain:u}=o,m=`cvauth.${u}`,L=`https://${m}/session/end`,g=`intro.${u}`,b=`https://${g}`;l==="loginStart"&&chrome.tabs.create({url:L,active:!1},e=>{if(!e||!e.id){console.error("탭 생성 실패");return}function n(t){t.tabId===e.id&&(chrome.webNavigation.onCompleted.removeListener(n),chrome.tabs.update(e.id,{url:b,active:!0}))}function d(t){t.tabId===e.id&&(chrome.webNavigation.onCompleted.removeListener(d),chrome.scripting.executeScript({target:{tabId:e.id},func:()=>{document.getElementById("md_login").querySelector("div").click()}}))}function a(t){t.tabId===e.id&&(chrome.webNavigation.onCompleted.removeListener(a),chrome.scripting.executeScript({target:{tabId:e.id},func:r=>{const{clinicIdDB:i,userIdDB:c,passwordDB:s}=r,p=document.getElementById("hospital"),h=document.getElementById("userID"),v=document.getElementById("passwordInput");p.value=i,h.value=c,v.value=s,document.querySelector('button[type="submit"]').click()},args:[o]}))}chrome.webNavigation.onCompleted.addListener(n,{url:[{hostSuffix:m,pathContains:"session/end/success"}]}),chrome.webNavigation.onCompleted.addListener(d,{url:[{hostContains:g}]}),chrome.webNavigation.onCompleted.addListener(a,{url:[{hostSuffix:m,pathContains:"interaction"}]})}),l==="secretLoginStart"&&chrome.windows.create({url:b,incognito:!0},e=>{if(chrome.runtime.lastError){console.error("창 생성 오류:",chrome.runtime.lastError.message);return}const n=e.tabs[0].id;chrome.tabs.onUpdated.addListener(function t(r,i){r===n&&i.status==="complete"&&(chrome.tabs.onUpdated.removeListener(t),chrome.scripting.executeScript({target:{tabId:n},func:()=>{const c=document.getElementById("md_login");if(!c){console.error("#md_login 요소를 찾을 수 없습니다.");return}const s=c.querySelector("div");if(!s){console.error("로그인 버튼을 찾을 수 없습니다.");return}s.click()}}))});function d(t){chrome.webNavigation.onCompleted.removeListener(d),chrome.scripting.executeScript({target:{tabId:n},func:()=>{document.getElementById("md_login").querySelector("div").click()}})}function a(t){t.tabId===n&&(chrome.webNavigation.onCompleted.removeListener(a),chrome.scripting.executeScript({target:{tabId:n},func:r=>{const{clinicIdDB:i,userIdDB:c,passwordDB:s}=r,p=document.getElementById("hospital"),h=document.getElementById("userID"),v=document.getElementById("passwordInput");p.value=i,h.value=c,v.value=s,document.querySelector('button[type="submit"]').click()},args:[o]}))}chrome.webNavigation.onCompleted.addListener(d,{url:[{hostContains:g}]}),chrome.webNavigation.onCompleted.addListener(a,{url:[{hostSuffix:m,pathContains:"interaction"}]})})});chrome.storage.onChanged.addListener((o,f)=>{for(let[I,{oldValue:l,newValue:u}]of Object.entries(o))console.log(`Storage key "${I}" in namespace "${f}" changed.`,`Old value was "${l}", new value is "${u}".`)});chrome.runtime.onInstalled.addListener(o=>{o.reason==="install"?console.log("확장 프로그램이 처음 설치됨"):o.reason==="update"?console.log("확장 프로그램이 업데이트됨"):o.reason==="chrome_update"&&console.log("Chrome이 업데이트됨")});
